# ESP_Intelligent_Vehicle项目总结

## 1.项目概述

ESP-Intelligent-Vehicle 是基于 ESP32 开发的Wi-Fi智能小车示例项目，可实现摄像头扫描二维码配网、扫描二维码信息解析并上报、通过遥控器sbus协议或局域网内socket建立TCP通信对小车进行控制、局域网内通过TCP通信发送命令控制小车进行物料搬运、小车定点寻路、视频同步、OTA等功能。

## 2.计划vs成果

本项目始于2020年8月11日，项目开展时间接近两个月，于国庆前完成了除箭头识别外该项目的所有功能及文档。

| 项目计划               | 完成度 | 备注                                                         |
| ---------------------- | ------ | ------------------------------------------------------------ |
| 四轮全向轮小车驱动     | 100%   | 可通过支持sbus协议的遥控器以及TCP Client发送命令分别控制     |
| 二维码扫描配网         | 100%   |                                                              |
| 局域网内TCP通信        | 100%   |                                                              |
| 二维码信息解析并上报PC | 100%   |                                                              |
| 物料搬运               | 100%   | 调节PWM占空比来调节舵机角度                                  |
| 通过二维码信息定点寻路 | 90%    | 由于小车装配精度较低以及缺乏传感器，小车暂不能精确的运动到相应位置点 |
| 视频同步               | 100%   | 同一局域网内PC端远程视频同步帧率约为10fps                    |
| OTA                    | 100%   |                                                              |
| 箭头识别               | 0      | 涉及到图像识别算法，未能在规定时间内完成                     |

## 3.项目总结

### 缺陷：

（1）在开发板上使用视频传输功能将会给芯片、CPU带来很大的压力，故视频同步功能与实时二维码扫描任务共同运行时，使用1帧缓冲区，驱动程序将等待当前帧结束（VSYNC）并启动I2S DMA，获取帧后，将停止I2S，这将使视频传输花费较长时间并引起卡顿。当使用2帧或更多帧缓冲区时，I2S以连续模式运行，这种方法虽然允许将帧频提高一倍，但给CPU 、内存带来了更多压力，这种情况下视频流帧率平均可达10fps。

​		  虽然帧率较低，但也可以在小车缓慢移动的过程中识别到二维码信息，同时远程监控视频流仍然保持10fps。

（2）四轮小车未作悬挂，机械误差可能导致四个轮子与地面的摩擦力不同，从而在控制小车行走时其运动路径会产生偏差。

（3）未使用定位器等传感模块进行辅助定位小车位置坐标，其在产生位置偏差时不能通过PID反馈调节自动修正。

（4）机械抓手较为简陋，开合角度限制了抓取物品的大小；同时两个自由度也限制了更多的空间移动范围。

### 后期完善：

（1）增加正交编码器（获取x轴y轴位置坐标）以及陀螺仪（获取z轴角速度）来确定小车实时位置，从而根据反馈偏差进行PID调节。目前已完成光纤陀螺仪串口接收以及数据帧解析两部分。

（2）更新小车底盘硬件，重构小车，增加悬挂结构，使四轮移动偏差减小。

（3）增加机械抓手的自由度，使其能够抓取到更大范围内的物品。（但开发板上引出的复用定时器IO数量不足，可能需要通过串行总线来控制多个舵机）

